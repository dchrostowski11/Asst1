#include <stdio.h>
#include <stdlib.h>
#include <stddef.h>
//#define malloc(x) mymalloc(x, __FILE__,__LINE__)
//#define free(x) free(x, __FILE__, __LINE__)

struct node { /* represents the data stored in each node of the linked list, whether a block of memory is full, and how many bytes/size of each block allocated */
    int free; 		// 1 = full, 0 = empty
    size_t size; 		// size of allocated block
    struct node *next; // points to next block of allocated memory
};

static char myblock[5000];
int amountLeft = 5000;
char* temp = &myblock[0];
struct node* head = NULL;

struct node* getBlock(struct node** mynode, size_t size){
	
	struct node* curr = head;
	
	while(curr != NULL && !(curr->free && curr->size >=size)){
		*mynode = curr;
		curr = curr->next;
	}
	
	return curr;
}

struct node* createBlock(struct node* mynode, size_t size){
	struct node *curr;
	curr = (struct node*) (((char*)temp) + sizeof(struct node)+size);
	if(mynode == NULL){
		
		mynode = curr;
	}
	
	curr->size = size;
	curr->next = NULL;
	curr->free = 0;
	return curr;
	
}
void * mymalloc(size_t size){
	
	struct node * curr = (struct node*) (((char*)temp) + sizeof(struct node)+size);
	struct node * last = (struct node*) (((char*)temp) + sizeof(struct node)+size);
	
	if(size<=0 ){
		printf("Invalid amount of memory requested\n");
		return NULL;
	}
	
	if(size>amountLeft){
		printf("Not enough memory left\n");
		return NULL;
	}
	
	if(head == NULL){
		curr->size = size;
		curr->next = NULL;
		curr->free = 0;
		head = curr;
	}else{
		last = head;
		curr = getBlock(&last, size);
		
		if(curr == NULL){
			curr = createBlock(last, size);
			
			if(curr == NULL){
				printf("unable to allocate memory\n");
				return NULL;
			}
			amountLeft -= size + sizeof(struct node);
		}else{
			curr -> free = 0;
		}
	}
	
	printf("Successfully allocated %lu bytes of memory\n", size);
	return ++curr;
	
}

/*void free(void* block){
	struct node* ptr = (struct node*)block;
	
	if(ptr == NULL){
		printf("hello\n");
		return;
	}
	
	
	ptr->free = 1;
	printf("Successfully freed memory\n");
	return;
}*/

int main(int argc, char **argv){

//	int i;
	free((struct node* )mymalloc(2));
    return 0;
}
